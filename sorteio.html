<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sorteio dos Jogos</title>
<style>
  * {
    box-sizing: border-box;
    font-family: "Poppins", sans-serif;
  }
  body {
    margin: 0;
    background: #f4f7fb;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    padding: 10px;
  }
  .container {
    background: white;
    width: 100%;
    max-width: 420px;
    padding: 20px 15px;
    border-radius: 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    overflow: hidden;
  }
  .header {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 20px;
    position: relative;
  }
  .header img {
    height: 40px;
    width: 40px;
    object-fit: contain;
    position: absolute;
    left: 0;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: pointer;
  }
  .header img:hover {
    transform: scale(1.2) rotate(360deg);
    box-shadow: 0 0 10px rgba(0, 147, 255, 0.7);
  }
  .header img:active {
    animation: pulse 0.2s ease;
  }
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); }
    100% { transform: scale(1); }
  }
  .header h1 {
    color: #0093ff;
    font-size: 1.6rem;
    margin: 0;
    text-align: center;
    width: 100%;
  }
  .menu-icon {
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    font-size: 1.5rem;
    cursor: pointer;
    color: #333;
    transition: transform 0.3s;
  }
  .menu-icon:hover {
    transform: translateY(-50%) scale(1.1);
  }
  .menu-dropdown {
    display: none;
    position: absolute;
    right: 0;
    top: 60px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    z-index: 1000;
    min-width: 150px;
  }
  .menu-dropdown a {
    display: flex;
    align-items: center;
    padding: 10px 15px;
    color: #333;
    text-decoration: none;
    font-size: 0.95rem;
    transition: background 0.2s;
  }
  .menu-dropdown a:hover {
    background: #e8f4ff;
  }
  .menu-dropdown a.trofeus::before {
    content: "üèÜ";
    margin-right: 8px;
  }
  .menu-dropdown a.regras::before {
    content: "üìú";
    margin-right: 8px;
  }
  .menu-dropdown a.sobre::before {
    content: "‚ÑπÔ∏è";
    margin-right: 8px;
  }
  .inputs {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 8px;
    margin-bottom: 20px;
  }
  input {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 10px;
    font-size: 0.95rem;
  }
  .jogador-ativo {
    background: #e8f4ff;
    border: 2px solid #0093ff;
  }
  .jogador-fora {
    background: #f0f0f0;
    border: 1px solid #ccc;
    color: #666;
  }
  .info {
    text-align: center;
    font-size: 0.9rem;
    color: #555;
    margin-bottom: 15px;
  }
  button {
    display: block;
    width: 100%;
    max-width: 260px;
    margin: 0 auto;
    padding: 12px 20px;
    border: none;
    border-radius: 30px;
    background: linear-gradient(90deg, #0093ff, #00c8ff);
    color: white;
    font-size: 1rem;
    cursor: pointer;
    transition: 0.3s;
  }
  button:hover {
    transform: scale(1.03);
  }
  .result {
    margin-top: 20px;
  }
  .dupla {
    background: #e8f4ff;
    margin-bottom: 10px;
    border-radius: 15px;
    padding: 10px 15px;
    text-align: left;
    font-weight: 500;
    font-size: 0.95rem;
    border: 1px solid #0093ff;
    cursor: pointer;
    transition: background 0.3s, border-color 0.3s, box-shadow 0.3s;
    position: relative;
  }
  .dupla:hover {
    background: #d8efff;
  }
  .dupla-vencedora {
    background: #e6ffed !important;
    border-color: #28a745 !important;
    animation: brilhoVerde 0.6s ease-out;
    margin-bottom: 10px !important;
    border-radius: 15px !important;
    padding: 10px 15px !important;
    text-align: left !important;
    font-weight: 500 !important;
    font-size: 0.95rem !important;
    border: 1px solid #28a745 !important;
  }
  .dupla-perdedora {
    background: #ffe6e6 !important;
    border-color: #dc3545 !important;
    animation: piscarVermelho 0.6s ease-out;
    opacity: 0.9;
    margin-bottom: 10px !important;
    border-radius: 15px !important;
    padding: 10px 15px !important;
    text-align: left !important;
    font-weight: 500 !important;
    font-size: 0.95rem !important;
    border: 1px solid #dc3545 !important;
  }
  .dupla-fora {
    background: #f0f0f0;
    border: 1px solid #ccc;
    color: #666;
    margin-bottom: 10px;
    border-radius: 15px;
    padding: 10px 15px;
    text-align: left;
    font-weight: 500;
    font-size: 0.95rem;
  }
  .loading {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 80px;
  }
  .ball {
    width: 18px;
    height: 18px;
    margin: 0 5px;
    border-radius: 50%;
    background: #e4ff1a;
    animation: bounce 0.9s infinite alternate ease-in-out;
  }
  .ball:nth-child(2) { animation-delay: 0.3s; }
  .ball:nth-child(3) { animation-delay: 0.6s; }
  @keyframes bounce {
    from { transform: translateY(0); }
    to { transform: translateY(-18px); }
  }
  @keyframes brilhoVerde { from { box-shadow: 0 0 0px #00ff80; } 50% { box-shadow: 0 0 15px #00ff80; } to { box-shadow: 0 0 0px #00ff80; } }
  @keyframes piscarVermelho { from { background: #ffe6e6; } 50% { background: #ffb3b3; } to { background: #ffe6e6; } }
  @keyframes aparecerTrofeu { from { opacity: 0; transform: scale(0.5); } to { opacity: 1; transform: scale(1); } }
  .trofeu { margin-left: 6px; display: inline-block; animation: aparecerTrofeu 0.4s ease-out; }
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
  }
  .modal-content {
    background-color: white;
    margin: 10% auto;
    padding: 20px;
    border-radius: 15px;
    width: 90%;
    max-width: 400px;
    max-height: 80vh;
    overflow-y: auto;
  }
  .modal-content h2 {
    text-align: center;
    color: #0093ff;
    margin-bottom: 15px;
  }
  .ranking-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    margin-bottom: 5px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #ffd700;
  }
  .ranking-name {
    font-weight: 500;
  }
  .ranking-trophies {
    color: #1a3c34;
    font-size: 1.2rem;
  }
  .modal-content p {
    font-size: 0.95rem;
    color: #333;
    line-height: 1.5;
  }
  .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    margin-bottom: 10px;
  }
  .close:hover {
    color: #000;
  }
  @media (max-width: 360px) {
    .header h1 { font-size: 1.3rem; }
    input { font-size: 0.85rem; padding: 8px; }
    button { font-size: 0.9rem; padding: 10px 15px; }
    .dupla, .dupla-fora { font-size: 0.9rem; }
    .header img { height: 64px; width: 64px; }
  }
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="https://i.imgur.com/rDZCHiH.png" alt="Logo" onclick="this.classList.add('pulse'); setTimeout(() => this.classList.remove('pulse'), 200);">
      <h1>Sorteio dos Jogos</h1>
      <span class="menu-icon" onclick="toggleMenu()">‚ò∞</span>
      <div class="menu-dropdown" id="menuDropdown">
        <a href="#" class="trofeus" onclick="abrirRanking()">Trof√©us</a>
        <a href="#" class="regras" onclick="abrirRegras()">Regras</a>
        <a href="#" class="sobre" onclick="abrirSobre()">Sobre</a>
      </div>
    </div>
    <div class="inputs">
      <input type="text" id="p1" value="Eduardo" class="jogador-ativo">
      <input type="text" id="p2" value="Julio" class="jogador-ativo">
      <input type="text" id="p3" value="Savio" class="jogador-ativo">
      <input type="text" id="p4" value="Wagner" class="jogador-ativo">
      <input type="text" id="p5" value="Ozimar" class="jogador-fora">
      <input type="text" id="p6" value="Artur" class="jogador-fora">
    </div>
    <p class="info">Apenas os 4 primeiros jogadores (em azul) s√£o sorteados para a primeira partida. Os outros est√£o de fora inicialmente.</p>
    <button id="sortear">üéæ Sortear Times</button>
    <div class="result" id="resultado"></div>
  </div>
  <!-- Modal de Ranking -->
  <div id="rankingModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="fecharRanking()">&times;</span>
      <h2>Ranking de Trof√©us</h2>
      <div id="rankingList"></div>
    </div>
  </div>
  <!-- Modal de Regras -->
  <div id="regrasModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="fecharModal('regrasModal')">&times;</span>
      <h2>Regras do App</h2>
      <p>
        1. O sistema sorteia duplas entre 6 jogadores.<br>
        2. Apenas os 4 primeiros jogadores (em azul) participam da primeira partida, enquanto os 2 √∫ltimos (em cinza) ficam de fora.<br>
        3. Ap√≥s cada partida, a dupla vencedora √© selecionada, e uma nova partida √© gerada.<br>
        4. Para a segunda partida, os vencedores da primeira jogam com os jogadores que estavam de fora.<br>
        5. A partir da terceira partida, jogadores que participaram de duas partidas seguidas s√£o substitu√≠dos pelos que estavam de fora.<br>
        6. O sistema evita repetir duplas de partidas anteriores.<br>
        7. Cada vit√≥ria concede 1 trof√©u para cada jogador da dupla vencedora, vis√≠vel no ranking de trof√©us.
      </p>
    </div>
  </div>
  <!-- Modal de Sobre -->
  <div id="sobreModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="fecharModal('sobreModal')">&times;</span>
      <h2>Sobre</h2>
      <p>Software desenvolvido por Eduardo Campelo para o play do Bisteca.</p>
    </div>
  </div>
<script>
  const botao = document.getElementById("sortear");
  const resultado = document.getElementById("resultado");
  let partidas = [];
  let ultimaDupla = null;
  let vencedorSelecionado = null;
  let clickTimeout = null;

  function embaralhar(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function isDuplaRepetida(dupla, partidas) {
    return partidas.some(p =>
      (p.dupla1[0] === dupla[0] && p.dupla1[1] === dupla[1]) ||
      (p.dupla1[1] === dupla[0] && p.dupla1[0] === dupla[1]) ||
      (p.dupla2[0] === dupla[0] && p.dupla2[1] === dupla[1]) ||
      (p.dupla2[1] === dupla[0] && p.dupla2[0] === dupla[1])
    );
  }

  function toggleMenu() {
    const menu = document.getElementById("menuDropdown");
    menu.style.display = menu.style.display === "block" ? "none" : "block";
  }

  function abrirRanking() {
    fecharMenu();
    const nomes = [
      document.getElementById("p1").value.trim(),
      document.getElementById("p2").value.trim(),
      document.getElementById("p3").value.trim(),
      document.getElementById("p4").value.trim(),
      document.getElementById("p5").value.trim(),
      document.getElementById("p6").value.trim(),
    ];
    const trofeus = {};
    nomes.forEach(nome => trofeus[nome] = 0);
    partidas.forEach(p => {
      if (p.vencedor) {
        const duplaVencedora = p.vencedor === "1" ? p.dupla1 : p.dupla2;
        duplaVencedora.forEach(jogador => {
          if (trofeus[jogador] !== undefined) {
            trofeus[jogador]++;
          }
        });
      }
    });
    const ranking = Object.entries(trofeus)
      .sort(([,a], [,b]) => b - a)
      .map(([jogador, count]) => `
        <div class="ranking-item">
          <span class="ranking-name">${jogador}</span>
          <span class="ranking-trophies">${count} üèÜ</span>
        </div>
      `).join('');
    document.getElementById("rankingList").innerHTML = ranking;
    document.getElementById("rankingModal").style.display = "block";
  }

  function abrirRegras() {
    fecharMenu();
    document.getElementById("regrasModal").style.display = "block";
  }

  function abrirSobre() {
    fecharMenu();
    document.getElementById("sobreModal").style.display = "block";
  }

  function fecharMenu() {
    document.getElementById("menuDropdown").style.display = "none";
  }

  function fecharRanking() {
    document.getElementById("rankingModal").style.display = "none";
  }

  function fecharModal(modalId) {
    document.getElementById(modalId).style.display = "none";
  }

  function criarPrimeiraPartida() {
    const nomes = [
      document.getElementById("p1").value.trim(),
      document.getElementById("p2").value.trim(),
      document.getElementById("p3").value.trim(),
      document.getElementById("p4").value.trim(),
      document.getElementById("p5").value.trim(),
      document.getElementById("p6").value.trim(),
    ];
    if (nomes.some(n => n === "")) {
      resultado.innerHTML = `<p style="color:red;text-align:center;">Preencha todos os 6 nomes!</p>`;
      return;
    }
    const primeirosQuatro = nomes.slice(0, 4);
    const embaralhados = embaralhar([...primeirosQuatro]);
    const dupla1 = [embaralhados[0], embaralhados[1]];
    const dupla2 = [embaralhados[2], embaralhados[3]];
    const deFora = nomes.filter(j => !primeirosQuatro.includes(j));
    partidas = [{
      numero: 1,
      dupla1,
      dupla2,
      deFora,
      vencedor: null
    }];
    mostrarPartidas();
  }

  function selecionarVencedor(partidaNumero, dupla) {
    const partidaIndex = partidas.findIndex(p => p.numero === partidaNumero);
    const partida = partidas[partidaIndex];
    if (partida.vencedor !== null) return;
    if (partidaIndex !== partidas.length - 1) return; // Apenas a √∫ltima partida √© clic√°vel

    const dupla1Elem = document.getElementById(`dupla1-${partidaNumero}`);
    const dupla2Elem = document.getElementById(`dupla2-${partidaNumero}`);

    if (vencedorSelecionado === dupla) {
      // Reverter sele√ß√£o
      dupla1Elem.classList.remove("dupla-vencedora", "dupla-perdedora");
      dupla2Elem.classList.remove("dupla-vencedora", "dupla-perdedora");
      dupla1Elem.classList.add("dupla");
      dupla2Elem.classList.add("dupla");
      dupla1Elem.innerHTML = `<strong>Dupla 1:</strong> ${partida.dupla1[0]} & ${partida.dupla1[1]}`;
      dupla2Elem.innerHTML = `<strong>Dupla 2:</strong> ${partida.dupla2[0]} & ${partida.dupla2[1]}`;
      vencedorSelecionado = null;
      if (clickTimeout) clearTimeout(clickTimeout);
      return;
    }

    vencedorSelecionado = dupla;
    if (dupla === 1) {
      dupla1Elem.classList.remove("dupla", "dupla-perdedora");
      dupla1Elem.classList.add("dupla-vencedora");
      dupla1Elem.innerHTML = `<strong>Dupla 1:</strong> ${partida.dupla1[0]} & ${partida.dupla1[1]} <span class="trofeu">üèÜ</span>`;
      dupla2Elem.classList.remove("dupla", "dupla-vencedora");
      dupla2Elem.classList.add("dupla-perdedora");
      dupla2Elem.innerHTML = `<strong>Dupla 2:</strong> ${partida.dupla2[0]} & ${partida.dupla2[1]}`;
    } else {
      dupla2Elem.classList.remove("dupla", "dupla-perdedora");
      dupla2Elem.classList.add("dupla-vencedora");
      dupla2Elem.innerHTML = `<strong>Dupla 2:</strong> ${partida.dupla2[0]} & ${partida.dupla2[1]} <span class="trofeu">üèÜ</span>`;
      dupla1Elem.classList.remove("dupla", "dupla-vencedora");
      dupla1Elem.classList.add("dupla-perdedora");
      dupla1Elem.innerHTML = `<strong>Dupla 1:</strong> ${partida.dupla1[0]} & ${partida.dupla1[1]}`;
    }

    clickTimeout = setTimeout(() => {
      partida.vencedor = dupla.toString();
      gerarProximaPartida();
      vencedorSelecionado = null;
    }, 500);
  }

  function mostrarPartidas() {
    let html = "";
    partidas.forEach(p => {
      const isPartidaAtual = p.numero === partidas.length && p.vencedor === null;
      const vencedorClass1 = p.vencedor === "1" ? "dupla-vencedora" : (p.vencedor === "2" ? "dupla-perdedora" : "dupla");
      const vencedorClass2 = p.vencedor === "2" ? "dupla-vencedora" : (p.vencedor === "1" ? "dupla-perdedora" : "dupla");
      const clicavel = isPartidaAtual ? `onclick="selecionarVencedor(${p.numero}, 1)"` : "";
      const clicavel2 = isPartidaAtual ? `onclick="selecionarVencedor(${p.numero}, 2)"` : "";
      html += `<h3 style='text-align:center;'>Partida ${p.numero}</h3>`;
      html += `<div id="dupla1-${p.numero}" class="${vencedorClass1}" ${clicavel}><strong>Dupla 1:</strong> ${p.dupla1[0]} & ${p.dupla1[1]} ${p.vencedor === "1" ? '<span class="trofeu">üèÜ</span>' : ''}</div>`;
      html += `<div id="dupla2-${p.numero}" class="${vencedorClass2}" ${clicavel2}><strong>Dupla 2:</strong> ${p.dupla2[0]} & ${p.dupla2[1]} ${p.vencedor === "2" ? '<span class="trofeu">üèÜ</span>' : ''}</div>`;
      html += `<div class="dupla-fora"><strong>De fora:</strong> ${p.deFora.join(" & ")}</div>`;
    });
    resultado.innerHTML = html;
  }

  function gerarProximaPartida() {
    const nomes = [
      document.getElementById("p1").value.trim(),
      document.getElementById("p2").value.trim(),
      document.getElementById("p3").value.trim(),
      document.getElementById("p4").value.trim(),
      document.getElementById("p5").value.trim(),
      document.getElementById("p6").value.trim(),
    ];
    const ultimaPartida = partidas[partidas.length - 1];
    const numeroPartida = partidas.length + 1;
    let vencedores = ultimaPartida.vencedor === "1" ? ultimaPartida.dupla1 : ultimaPartida.dupla2;
    let perdedores = ultimaPartida.vencedor === "1" ? ultimaPartida.dupla2 : ultimaPartida.dupla1;
    let deFora = ultimaPartida.deFora;
    let jogadoresAtivos = [];
    if (partidas.length === 1) {
      jogadoresAtivos = [...vencedores, ...deFora];
      const embaralhados = embaralhar([...jogadoresAtivos]);
      let dupla1, dupla2;
      for (let i = 0; i < 10; i++) {
        dupla1 = [embaralhados[0], embaralhados[1]];
        dupla2 = [embaralhados[2], embaralhados[3]];
        if (!(dupla1[0] === vencedores[0] && dupla1[1] === vencedores[1]) &&
            !(dupla1[0] === vencedores[1] && dupla1[1] === vencedores[0]) &&
            !(dupla2[0] === vencedores[0] && dupla2[1] === vencedores[1]) &&
            !(dupla2[0] === vencedores[1] && dupla2[1] === vencedores[0])) {
          break;
        }
        embaralhar(embaralhados);
      }
      const novaPartida = {
        numero: numeroPartida,
        dupla1: dupla1,
        dupla2: dupla2,
        deFora: perdedores,
        vencedor: null
      };
      partidas.push(novaPartida);
      ultimaDupla = vencedores;
      mostrarPartidas();
      return;
    }
    const penultimaPartida = partidas[partidas.length - 2];
    const jogadoresPenultima = [...penultimaPartida.dupla1, ...penultimaPartida.dupla2];
    vencedores = vencedores.filter(j => !jogadoresPenultima.includes(j));
    jogadoresAtivos = [...vencedores];
    const perdedoresValidos = perdedores.filter(j => !jogadoresPenultima.includes(j));
    jogadoresAtivos = [...jogadoresAtivos, ...perdedoresValidos];
    jogadoresAtivos = [...jogadoresAtivos, ...deFora];
    jogadoresAtivos = jogadoresAtivos.slice(0, 4);
    let dupla1, dupla2;
    for (let i = 0; i < 10; i++) {
      const embaralhados = embaralhar([...jogadoresAtivos]);
      dupla1 = [embaralhados[0], embaralhados[1]];
      dupla2 = [embaralhados[2], embaralhados[3]];
      if (!isDuplaRepetida(dupla1, partidas) && !isDuplaRepetida(dupla2, partidas)) {
        break;
      }
    }
    const novaPartida = {
      numero: numeroPartida,
      dupla1: dupla1,
      dupla2: dupla2,
      deFora: nomes.filter(j => !jogadoresAtivos.includes(j)),
      vencedor: null
    };
    partidas.push(novaPartida);
    ultimaDupla = vencedores;
    mostrarPartidas();
  }

  botao.addEventListener("click", () => {
    resultado.innerHTML = `
      <div class="loading">
        <div class="ball"></div>
        <div class="ball"></div>
        <div class="ball"></div>
      </div>
      <p style="text-align:center;">Sorteando as duplas...</p>
    `;
    setTimeout(() => {
      partidas = [];
      ultimaDupla = null;
      vencedorSelecionado = null;
      criarPrimeiraPartida();
    }, 2000);
  });

  window.onclick = function(event) {
    const modalRanking = document.getElementById("rankingModal");
    const modalRegras = document.getElementById("regrasModal");
    const modalSobre = document.getElementById("sobreModal");
    const menu = document.getElementById("menuDropdown");
    if (event.target == modalRanking) {
      fecharRanking();
    } else if (event.target == modalRegras) {
      fecharModal("regrasModal");
    } else if (event.target == modalSobre) {
      fecharModal("sobreModal");
    } else if (!event.target.closest(".menu-icon") && !event.target.closest(".menu-dropdown")) {
      fecharMenu();
    }
  }
</script>
</body>
</html>