<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sorteio dos Jogos</title>
<style>
  * { box-sizing: border-box; font-family: "Poppins", sans-serif; }
  body { margin:0; background:#f4f7fb; display:flex; flex-direction:column; align-items:center; min-height:100vh; padding:10px; }
  .container { background:white; width:100%; max-width:420px; padding:20px 15px; border-radius:20px; box-shadow:0 4px 12px rgba(0,0,0,0.1); overflow:hidden; }
  .header { display:flex; align-items:center; justify-content:center; margin-bottom:20px; position:relative; }
  .header img { height:40px; width:40px; object-fit:contain; position:absolute; left:0; transition:transform .3s ease, box-shadow .3s ease; cursor:pointer; }
  .header img:hover { transform:scale(1.2) rotate(360deg); box-shadow:0 0 10px rgba(0,147,255,0.7); }
  .header h1 { color:#0093ff; font-size:1.6rem; margin:0; text-align:center; width:100%; }
  .menu-icon { position:absolute; right:0; top:50%; transform:translateY(-50%); font-size:1.5rem; cursor:pointer; color:#333; transition:transform .3s; }
  .menu-icon:hover { transform:translateY(-50%) scale(1.1); }
  .menu-dropdown { display:none; position:absolute; right:0; top:60px; background:white; border-radius:8px; box-shadow:0 4px 8px rgba(0,0,0,0.2); z-index:1000; min-width:150px; }
  .menu-dropdown a { display:flex; align-items:center; padding:10px 15px; color:#333; text-decoration:none; font-size:.95rem; transition:background .2s; }
  .menu-dropdown a:hover { background:#e8f4ff; }
  .menu-dropdown a.trofeus::before { content:"üèÜ"; margin-right:8px; }
  .menu-dropdown a.regras::before { content:"üìú"; margin-right:8px; }
  .menu-dropdown a.sobre::before { content:"‚ÑπÔ∏è"; margin-right:8px; }

  .inputs { display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:8px; margin-bottom:20px; }
  input { width:100%; padding:10px; border:1px solid #ddd; border-radius:10px; font-size:.95rem; }

  .jogador-ativo { background:#e8f4ff; border:2px solid #0093ff; }
  .jogador-fora { background:#f0f0f0; border:1px solid #ccc; color:#666; }

  .info { text-align:center; font-size:.9rem; color:#555; margin-bottom:15px; }

  button { display:block; width:100%; max-width:260px; margin:0 auto; padding:12px 20px; border:none; border-radius:30px; background:linear-gradient(90deg,#0093ff,#00c8ff); color:white; font-size:1rem; cursor:pointer; transition:.3s; }
  button:hover { transform:scale(1.03); }

  .result { margin-top:20px; }

  .dupla {
    background:#e8f4ff;
    margin-bottom:10px;
    border-radius:15px;
    padding:10px 15px;
    text-align:left;
    font-weight:500;
    font-size:.95rem;
    border:1px solid #0093ff;
    cursor:pointer;
    transition:background .3s, border-color .3s, box-shadow .3s;
    position:relative;
  }
  .dupla:hover { background:#d8efff; }

  .dupla-vencedora { background:#e6ffed !important; border-color:#28a745 !important; animation:brilhoVerde .6s ease-out; }
  .dupla-perdedora { background:#ffe6e6 !important; border-color:#dc3545 !important; animation:piscarVermelho .6s ease-out; opacity:.95; }

  .dupla-fora { background:#f0f0f0; border:1px solid #ccc; color:#666; margin-bottom:10px; border-radius:15px; padding:10px 15px; text-align:left; font-weight:500; font-size:.95rem; }

  .loading { display:flex; justify-content:center; align-items:center; height:80px; }
  .ball { width:18px; height:18px; margin:0 5px; border-radius:50%; background:#e4ff1a; animation:bounce .9s infinite alternate ease-in-out; }
  .ball:nth-child(2){animation-delay:.3s;} .ball:nth-child(3){animation-delay:.6s;}
  @keyframes bounce { from{transform:translateY(0);} to{transform:translateY(-18px);} }
  @keyframes brilhoVerde { from{box-shadow:0 0 0px #00ff80;} 50%{box-shadow:0 0 15px #00ff80;} to{box-shadow:0 0 0px #00ff80;} }
  @keyframes piscarVermelho { from{background:#ffe6e6;} 50%{background:#ffb3b3;} to{background:#ffe6e6;} }

  .trofeu { margin-left:6px; display:inline-block; animation:aparecerTrofeu .4s ease-out; }
  @keyframes aparecerTrofeu { from{opacity:0; transform:scale(.6);} to{opacity:1; transform:scale(1);} }

  .modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background-color:rgba(0,0,0,.5); }
  .modal-content { background-color:white; margin:10% auto; padding:20px; border-radius:15px; width:90%; max-width:400px; max-height:80vh; overflow-y:auto; }
  .modal-content h2 { text-align:center; color:#0093ff; margin-bottom:15px; }
  .ranking-item { display:flex; justify-content:space-between; align-items:center; padding:10px; margin-bottom:5px; background:#f8f9fa; border-radius:8px; border-left:4px solid #ffd700; }
  .ranking-name { font-weight:500; }
  .ranking-trophies { color:#1a3c34; font-size:1.2rem; }

  .close { color:#aaa; float:right; font-size:28px; font-weight:bold; cursor:pointer; margin-bottom:10px; }
  .close:hover { color:#000; }

  @media(max-width:360px){ .header h1{font-size:1.3rem;} input{font-size:.85rem;padding:8px;} button{font-size:.9rem;padding:10px 15px;} .dupla,.dupla-fora{font-size:.9rem;} .header img{height:64px;width:64px;} }
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="https://i.imgur.com/rDZCHiH.png" alt="Logo" onclick="this.classList.add('pulse'); setTimeout(()=>this.classList.remove('pulse'),200);">
      <h1>Sorteio dos Jogos</h1>
      <span class="menu-icon" onclick="toggleMenu()">‚ò∞</span>
      <div class="menu-dropdown" id="menuDropdown">
        <a href="#" class="trofeus" onclick="abrirRanking()">Trof√©us</a>
        <a href="#" class="regras" onclick="abrirRegras()">Regras</a>
        <a href="#" class="sobre" onclick="abrirSobre()">Sobre</a>
      </div>
    </div>

    <div class="inputs">
      <input type="text" id="p1" value="Eduardo" class="jogador-ativo">
      <input type="text" id="p2" value="Julio" class="jogador-ativo">
      <input type="text" id="p3" value="Savio" class="jogador-ativo">
      <input type="text" id="p4" value="Wagner" class="jogador-ativo">
      <input type="text" id="p5" value="Ozimar" class="jogador-fora">
      <input type="text" id="p6" value="Artur" class="jogador-fora">
    </div>

    <p class="info">Apenas os 4 primeiros jogadores (em azul) s√£o sorteados para a primeira partida. Os outros est√£o de fora inicialmente.</p>
    <button id="sortear">üéæ Sortear Primeira Partida</button>
    <div class="result" id="resultado"></div>
  </div>

  <!-- Ranking Modal -->
  <div id="rankingModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="fecharRanking()">&times;</span>
      <h2>Ranking de Trof√©us</h2>
      <div id="rankingList"></div>
    </div>
  </div>

  <!-- Regras Modal -->
  <div id="regrasModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="fecharModal('regrasModal')">&times;</span>
      <h2>Regras do App</h2>
      <p>
        1. O sistema sorteia duplas entre 6 jogadores.<br>
        2. Apenas os 4 primeiros jogadores (em azul) participam da primeira partida, enquanto os 2 √∫ltimos (em cinza) ficam de fora.<br>
        3. Ap√≥s cada partida, a dupla vencedora √© selecionada, e a sequ√™ncia de partidas √© gerada seguindo as regras combinat√≥rias.<br>
        4. Para a segunda partida, os vencedores da primeira jogam com os jogadores que estavam de fora (sorteio entre os dois de fora).<br>
        5. A partir da terceira partida, jogadores que participaram de duas partidas seguidas s√£o substitu√≠dos pelos que estavam de fora.<br>
        6. O sistema evita repetir duplas de partidas anteriores at√© esgotar as combina√ß√µes.<br>
        7. Cada vit√≥ria concede 1 trof√©u para cada jogador da dupla vencedora, vis√≠vel no ranking de trof√©us.
      </p>
    </div>
  </div>

  <!-- Sobre Modal -->
  <div id="sobreModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="fecharModal('sobreModal')">&times;</span>
      <h2>Sobre</h2>
      <p>Software desenvolvido por Eduardo Campelo para o play do Bisteca.</p>
    </div>
  </div>

<script>
/* ---------- estado helpers ---------- */
const botao = document.getElementById("sortear");
const resultado = document.getElementById("resultado");
let partidas = [];                 // { numero, dupla1:[a,b], dupla2:[c,d], deFora:[e,f], vencedor:null or '1'/'2' }
let usedPairs = new Set();         // pares j√° jogados, formato "A|B" ordenado

function keyPair(a,b){ return [a,b].sort().join('|'); }
function embaralhar(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]] } return arr; }
function isDuplaRepetida(dupla){ return usedPairs.has(keyPair(dupla[0],dupla[1])); }

/* ---------- menu / modais (mantidos) ---------- */
function toggleMenu(){ const m=document.getElementById("menuDropdown"); m.style.display = m.style.display==='block' ? 'none' : 'block'; }
function fecharMenu(){ document.getElementById("menuDropdown").style.display='none'; }
function abrirRanking(){ fecharMenu(); atualizarRanking(); document.getElementById("rankingModal").style.display='block'; }
function fecharRanking(){ document.getElementById("rankingModal").style.display='none'; }
function abrirRegras(){ fecharMenu(); document.getElementById("regrasModal").style.display='block'; }
function abrirSobre(){ fecharMenu(); document.getElementById("sobreModal").style.display='block'; }
function fecharModal(id){ document.getElementById(id).style.display='none'; }

/* ---------- ranking (mantido) ---------- */
function atualizarRanking(){
  const nomes = [...Array(6)].map((_,i)=>document.getElementById('p'+(i+1)).value.trim());
  const trofeus = {}; nomes.forEach(n=>trofeus[n]=0);
  partidas.forEach(p=>{
    if(p.vencedor){
      const vencedora = p.vencedor==='1' ? p.dupla1 : p.dupla2;
      vencedora.forEach(j => { if(trofeus[j]!==undefined) trofeus[j]++; });
    }
  });
  const rankingHtml = Object.entries(trofeus).sort(([,a],[,b])=>b-a).map(([nome,count])=>`
    <div class="ranking-item">
      <span class="ranking-name">${nome}</span>
      <span class="ranking-trophies">${count} üèÜ</span>
    </div>
  `).join('');
  document.getElementById('rankingList').innerHTML = rankingHtml;
}

/* ---------- criar primeira partida (igual ao anterior) ---------- */
function criarPrimeiraPartida(){
  const nomes = [...Array(6)].map((_,i)=>document.getElementById('p'+(i+1)).value.trim());
  if(nomes.some(n=>!n)){ resultado.innerHTML = `<p style="color:red;text-align:center;">Preencha todos os 6 nomes!</p>`; return; }
  const primeirosQuatro = nomes.slice(0,4);
  const embar = embaralhar([...primeirosQuatro]);
  const dupla1 = [embar[0], embar[1]];
  const dupla2 = [embar[2], embar[3]];
  const deFora = nomes.slice(4);
  partidas = [{ numero:1, dupla1, dupla2, deFora, vencedor:null }];
  usedPairs.clear(); // limpar hist√≥rico de pares porque iniciamos nova sequ√™ncia
  mostrarPartidas();
}

/* ---------- helper: attach listeners to dinamically created dupla elements ---------- */
function attachClickListeners(){
  // para cada partida, substitui o n√≥ (limpa listeners antigos) e adiciona novo listener se vencedor === null
  partidas.forEach(p => {
    const id1 = `dupla1-${p.numero}`;
    const id2 = `dupla2-${p.numero}`;
    const el1 = document.getElementById(id1);
    const el2 = document.getElementById(id2);
    if(!el1 || !el2) return;
    // substitui por clone para limpar listeners antigos
    const newEl1 = el1.cloneNode(true);
    el1.parentNode.replaceChild(newEl1, el1);
    const newEl2 = el2.cloneNode(true);
    el2.parentNode.replaceChild(newEl2, el2);
    // somente se ainda n√£o houver vencedor, adiciona listener
    if(p.vencedor === null){
      newEl1.style.cursor = 'pointer';
      newEl2.style.cursor = 'pointer';
      newEl1.addEventListener('click', ()=>selecionarVencedor(p.numero, 1));
      newEl2.addEventListener('click', ()=>selecionarVencedor(p.numero, 2));
    } else {
      newEl1.style.cursor = 'default';
      newEl2.style.cursor = 'default';
    }
  });
}

/* ---------- mostrar partidas (mant√©m visuais/trof√©u) ---------- */
function mostrarPartidas(){
  let html = '';
  partidas.forEach(p=>{
    const class1 = p.vencedor === '1' ? 'dupla dupla-vencedora' : (p.vencedor === '2' ? 'dupla dupla-perdedora' : 'dupla');
    const class2 = p.vencedor === '2' ? 'dupla dupla-vencedora' : (p.vencedor === '1' ? 'dupla dupla-perdedora' : 'dupla');
    html += `<h3 style="text-align:center;">Partida ${p.numero}</h3>`;
    html += `<div id="dupla1-${p.numero}" class="${class1}"><strong>Dupla 1:</strong> ${p.dupla1[0]} & ${p.dupla1[1]} ${p.vencedor==='1'?'<span class="trofeu">üèÜ</span>':''}</div>`;
    html += `<div id="dupla2-${p.numero}" class="${class2}"><strong>Dupla 2:</strong> ${p.dupla2[0]} & ${p.dupla2[1]} ${p.vencedor==='2'?'<span class="trofeu">üèÜ</span>':''}</div>`;
    html += `<div class="dupla-fora"><strong>De fora:</strong> ${p.deFora.join(' & ')}</div>`;
  });
  resultado.innerHTML = html;
  // reatribui listeners aos elementos rec√©m-criados
  attachClickListeners();
  atualizarRanking();
}

/* ---------- sele√ß√£o de vencedor (mant√©m classes) ---------- */
function selecionarVencedor(partidaNumero, dupla){
  const idx = partidas.findIndex(p=>p.numero===partidaNumero);
  if(idx === -1) return;
  const partida = partidas[idx];
  if(partida.vencedor !== null) return;
  partida.vencedor = dupla.toString();

  // registrar pares desta partida como jogados
  usedPairs.add(keyPair(partida.dupla1[0], partida.dupla1[1]));
  usedPairs.add(keyPair(partida.dupla2[0], partida.dupla2[1]));

  // atualizar UI (mantendo .dupla)
  const d1 = document.getElementById(`dupla1-${partidaNumero}`);
  const d2 = document.getElementById(`dupla2-${partidaNumero}`);
  if(dupla === 1){
    if(d1) { d1.classList.add('dupla-vencedora'); d1.classList.remove('dupla-perdedora'); d1.innerHTML = `<strong>Dupla 1:</strong> ${partida.dupla1[0]} & ${partida.dupla1[1]} <span class="trofeu">üèÜ</span>`; }
    if(d2) { d2.classList.add('dupla-perdedora'); d2.classList.remove('dupla-vencedora'); d2.innerHTML = `<strong>Dupla 2:</strong> ${partida.dupla2[0]} & ${partida.dupla2[1]}`; }
  } else {
    if(d2) { d2.classList.add('dupla-vencedora'); d2.classList.remove('dupla-perdedora'); d2.innerHTML = `<strong>Dupla 2:</strong> ${partida.dupla2[0]} & ${partida.dupla2[1]} <span class="trofeu">üèÜ</span>`; }
    if(d1) { d1.classList.add('dupla-perdedora'); d1.classList.remove('dupla-vencedora'); d1.innerHTML = `<strong>Dupla 1:</strong> ${partida.dupla1[0]} & ${partida.dupla1[1]}`; }
  }

  // Se for a primeira partida, gere automaticamente TODA a sequ√™ncia (2..9) e mostre tudo
  if(partidaNumero === 1){
    setTimeout(()=> {
      gerarSequenciaAposPrimeira(); // gera todas as partidas restantes de uma vez
      mostrarPartidas();
    }, 350);
  } else {
    // atualiza√ß√£o visual e reatribui√ß√£o de listeners
    setTimeout(()=> { mostrarPartidas(); }, 200);
  }
}

/* ---------- util: todas partit√ß√µes 4 => 2 pares ---------- */
function todasParticoes4(lista4){
  const [a,b,c,d] = lista4;
  return [
    [[a,b],[c,d]],
    [[a,c],[b,d]],
    [[a,d],[b,c]]
  ];
}

/* ---------- gerar pr√≥xima partida baseada em estado simul√°vel (n√£o exige vencedor da √∫ltima) ---------- */
function gerarProximaPartidaSimulada(stateUltima, statePenultima){
  const nomes = [...Array(6)].map((_,i)=>document.getElementById('p'+(i+1)).value.trim());
  const jogadoresUltima = [...stateUltima.dupla1, ...stateUltima.dupla2];
  const jogadoresPenultima = statePenultima ? [...statePenultima.dupla1, ...statePenultima.dupla2] : [];
  const mustLeave = jogadoresUltima.filter(p => jogadoresPenultima.includes(p));
  const permanecer = jogadoresUltima.filter(p => !mustLeave.includes(p));
  const entra = stateUltima.deFora.slice();
  let candidatos = [...permanecer, ...entra];
  candidatos = candidatos.slice(0,4);
  if(candidatos.length < 4){
    const faltam = nomes.filter(n => !candidatos.includes(n) && !jogadoresUltima.includes(n));
    while(candidatos.length < 4 && faltam.length) candidatos.push(faltam.shift());
  }
  if(candidatos.length < 4) return null;
  const opcoes = todasParticoes4(candidatos);
  const ord = embaralhar(opcoes.slice());
  let escolhida = null;
  for(const opt of ord){
    if(!isDuplaRepetida(opt[0]) && !isDuplaRepetida(opt[1])){
      escolhida = opt; break;
    }
  }
  if(!escolhida){
    let best = ord[0], bestR = 10;
    ord.forEach(opt=>{
      const r = (isDuplaRepetida(opt[0])?1:0) + (isDuplaRepetida(opt[1])?1:0);
      if(r < bestR){ bestR = r; best = opt; }
    });
    escolhida = best;
  }
  if(!escolhida) return null;
  const dupla1 = escolhida[0], dupla2 = escolhida[1];
  const novaDeFora = nomes.filter(n => !candidatos.includes(n));
  usedPairs.add(keyPair(dupla1[0],dupla1[1]));
  usedPairs.add(keyPair(dupla2[0],dupla2[1]));
  return { numero: 0, dupla1, dupla2, deFora: novaDeFora, vencedor: null };
}

/* ---------- gerar toda sequ√™ncia ap√≥s partida 1 (usa apenas vencedor da 1¬™) ---------- */
function gerarSequenciaAposPrimeira(){
  if(partidas.length === 0) return;
  const primeira = partidas[0];
  if(!primeira.vencedor) return;
  partidas = [partidas[0]];
  usedPairs.clear();
  usedPairs.add(keyPair(primeira.dupla1[0], primeira.dupla1[1]));
  usedPairs.add(keyPair(primeira.dupla2[0], primeira.dupla2[1]));
  let states = [];
  states.push({ dupla1: primeira.dupla1.slice(), dupla2: primeira.dupla2.slice(), deFora: primeira.deFora.slice() });
  const vencedores = primeira.vencedor === '1' ? primeira.dupla1.slice() : primeira.dupla2.slice();
  const perdedores = primeira.vencedor === '1' ? primeira.dupla2.slice() : primeira.dupla1.slice();
  const deFora = primeira.deFora.slice();
  const embFor = embaralhar(deFora.slice());
  const p2_dupla1 = [vencedores[0], embFor[0]];
  const p2_dupla2 = [vencedores[1], embFor[1]];
  const state2 = { dupla1: p2_dupla1, dupla2: p2_dupla2, deFora: perdedores.slice() };
  usedPairs.add(keyPair(p2_dupla1[0], p2_dupla1[1]));
  usedPairs.add(keyPair(p2_dupla2[0], p2_dupla2[1]));
  states.push(state2);
  for(let idx = 3; idx <= 9; idx++){
    const stateUlt = states[states.length - 1];
    const statePen = states.length >= 2 ? states[states.length - 2] : null;
    const nova = gerarProximaPartidaSimulada(stateUlt, statePen);
    if(!nova) break;
    nova.numero = idx;
    states.push({ dupla1: nova.dupla1.slice(), dupla2: nova.dupla2.slice(), deFora: nova.deFora.slice() });
  }
  for(let i = 1; i < states.length; i++){
    const st = states[i];
    partidas.push({ numero: partidas.length+1, dupla1: st.dupla1.slice(), dupla2: st.dupla2.slice(), deFora: st.deFora.slice(), vencedor: null });
  }
}

/* ---------- evento do bot√£o sortear (apenas gera 1¬™ partida) ---------- */
botao.addEventListener('click', ()=>{
  resultado.innerHTML = `<div class="loading"><div class="ball"></div><div class="ball"></div><div class="ball"></div></div><p style="text-align:center;">Sorteando as duplas...</p>`;
  setTimeout(()=>{
    partidas = [];
    usedPairs.clear();
    criarPrimeiraPartida();
  }, 700);
});

/* ---------- fechar modais/menu ao clicar fora ---------- */
window.onclick = function(evt){
  const modalRanking = document.getElementById("rankingModal");
  const modalRegras = document.getElementById("regrasModal");
  const modalSobre = document.getElementById("sobreModal");
  const menu = document.getElementById("menuDropdown");
  if(evt.target == modalRanking) fecharRanking();
  else if(evt.target == modalRegras) fecharModal('regrasModal');
  else if(evt.target == modalSobre) fecharModal('sobreModal');
  else if(!evt.target.closest('.menu-icon') && !evt.target.closest('.menu-dropdown')) fecharMenu();
};
</script>
</body>
</html>
